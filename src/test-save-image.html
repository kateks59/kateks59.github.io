<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/file-input/file-input.html"><link rel="import" href="../bower_components/file-input/image-input.html"><link rel="import" href="shared-styles.html"><link rel="import" href="../bower_components/file-input/file-input.html"></head><body><dom-module id="test-save-image"><template><style>iron-image{--iron-image-width:30%;--iron-image-height:30%;}</style><image-input id="imageProduct" default-image="https://dummyimage.com/128x128/000000/fff.png&amp;text=image-file"></image-input><button on-tap="getImage">save</button> <button on-tap="readImage">read</button><paper-input id="srcImage"></paper-input><iron-image id="imageResult" src="{{src}}"></iron-image></template><script>Polymer({is:"test-save-image",properties:{src:{type:String,value:"images/manifest/notImage.png"}},indexedDB:window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,IDBTransaction:window.IDBTransaction||window.webkitIDBTransaction,db:null,ready:function(){this.initDb()},initDb:function(){var a=this.indexedDB.open("Images",1);a.onsuccess=function(){this.db=a.result},a.onerror=function(a){console.log("IndexedDB error: "+a.target.errorCode)},a.onupgradeneeded=function(a){var b=a.currentTarget.result.createObjectStore("image",{keyPath:"id",autoIncrement:!0});b.createIndex("value","value")}},getImage:function(){var a,b=this,c=this.$.imageProduct.value,d=new XMLHttpRequest;d.open("GET",c,!0),d.responseType="blob",d.addEventListener("load",function(){200===d.status&&(console.log("Image retrieved"),a=d.response,console.log("Blob:"+a),b.saveImage(a))},!1),d.send()},saveImage:function(a){var b,c=this,d=this.indexedDB.open("Images",1);d.onsuccess=function(){b=d.result;var c=b.transaction("image","readwrite"),e=c.objectStore("image");e.add({value:a})}},readImage:function(){var a,b,c,d=this.indexedDB.open("Images",1),e=this;d.onsuccess=function(){a=d.result;var f=a.transaction("image","readwrite"),g=f.objectStore("image"),h=g.openCursor();h.onsuccess=function(a){if(a.target.result){b=a.target.result.value.value,console.log("Got elephant!"+b);var d=window.URL||window.webkitURL;c=d.createObjectURL(b),e.$.srcImage.value=c,e.src=c}}}}});</script></dom-module></body></html>