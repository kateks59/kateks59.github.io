<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="iron-image" assetpath="../bower_components/iron-image/"><template><style>:host{display:inline-block;overflow:hidden;position:relative;}#baseURIAnchor{display:none;}#sizedImgDiv{position:absolute;top:0px;right:0px;bottom:0px;left:0px;display:none;}#img{display:block;width:var(--iron-image-width, auto);height:var(--iron-image-height, auto);}:host([sizing]) #sizedImgDiv{display:block;}:host([sizing]) #img{display:none;}#placeholder{position:absolute;top:0px;right:0px;bottom:0px;left:0px;background-color:inherit;opacity:1;@apply --iron-image-placeholder;}#placeholder.faded-out{transition:opacity 0.5s linear;opacity:0;}</style><a id="baseURIAnchor" href="#"></a><div id="sizedImgDiv" role="img" hidden$="[[_computeImgDivHidden(sizing)]]" aria-hidden$="[[_computeImgDivARIAHidden(alt)]]" aria-label$="[[_computeImgDivARIALabel(alt, src)]]"></div><img id="img" alt$="[[alt]]" hidden$="[[_computeImgHidden(sizing)]]" crossorigin$="[[crossorigin]]" on-load="_imgOnLoad" on-error="_imgOnError"><div id="placeholder" hidden$="[[_computePlaceholderHidden(preload, fade, loading, loaded)]]" class$="[[_computePlaceholderClassName(preload, fade, loading, loaded)]]"></div></template><script>Polymer({is:'iron-image',properties:{src:{type:String,value:''},alt:{type:String,value:null},crossorigin:{type:String,value:null},preventLoad:{type:Boolean,value:!1},sizing:{type:String,value:null,reflectToAttribute:!0},position:{type:String,value:'center'},preload:{type:Boolean,value:!1},placeholder:{type:String,value:null,observer:'_placeholderChanged'},fade:{type:Boolean,value:!1},loaded:{notify:!0,readOnly:!0,type:Boolean,value:!1},loading:{notify:!0,readOnly:!0,type:Boolean,value:!1},error:{notify:!0,readOnly:!0,type:Boolean,value:!1},width:{observer:'_widthChanged',type:Number,value:null},height:{observer:'_heightChanged',type:Number,value:null}},observers:['_transformChanged(sizing, position)','_loadStateObserver(src, preventLoad)'],created:function(){this._resolvedSrc=''},_imgOnLoad:function(){this.$.img.src!==this._resolveSrc(this.src)||(this._setLoading(!1),this._setLoaded(!0),this._setError(!1))},_imgOnError:function(){this.$.img.src!==this._resolveSrc(this.src)||(this.$.img.removeAttribute('src'),this.$.sizedImgDiv.style.backgroundImage='',this._setLoading(!1),this._setLoaded(!1),this._setError(!0))},_computePlaceholderHidden:function(){return!this.preload||!this.fade&&!this.loading&&this.loaded},_computePlaceholderClassName:function(){return this.preload&&this.fade&&!this.loading&&this.loaded?'faded-out':''},_computeImgDivHidden:function(){return!this.sizing},_computeImgDivARIAHidden:function(){return''===this.alt?'true':void 0},_computeImgDivARIALabel:function(){if(null!==this.alt)return this.alt;if(''===this.src)return'';var a=this._resolveSrc(this.src);return a.replace(/[?|#].*/g,'').split('/').pop()},_computeImgHidden:function(){return!!this.sizing},_widthChanged:function(){this.style.width=isNaN(this.width)?this.width:this.width+'px'},_heightChanged:function(){this.style.height=isNaN(this.height)?this.height:this.height+'px'},_loadStateObserver:function(a,b){var c=this._resolveSrc(a);c===this._resolvedSrc||(this._resolvedSrc='',this.$.img.removeAttribute('src'),this.$.sizedImgDiv.style.backgroundImage='',''===a||b?(this._setLoading(!1),this._setLoaded(!1),this._setError(!1)):(this._resolvedSrc=c,this.$.img.src=this._resolvedSrc,this.$.sizedImgDiv.style.backgroundImage='url("'+this._resolvedSrc+'")',this._setLoading(!0),this._setLoaded(!1),this._setError(!1)))},_placeholderChanged:function(){this.$.placeholder.style.backgroundImage=this.placeholder?'url("'+this.placeholder+'")':''},_transformChanged:function(){var a=this.$.sizedImgDiv.style,b=this.$.placeholder.style;a.backgroundSize=b.backgroundSize=this.sizing,a.backgroundPosition=b.backgroundPosition=this.sizing?this.position:'',a.backgroundRepeat=b.backgroundRepeat=this.sizing?'no-repeat':''},_resolveSrc:function(a){var b=Polymer.ResolveUrl.resolveUrl(a,this.$.baseURIAnchor.href);return'/'===b[0]&&(b=(location.origin||location.protocol+'//'+location.host)+b),b}});</script></dom-module></div><dom-module id="shop-list"><template><style>google-map{height:300px;}</style><h1>Hello [[nameShop]]</h1><iron-image id="idImageShop" src="images\manifest\notImage.png" on-tap="openDialogImage"></iron-image><paper-dialog id="imageForShop"><paper-dialog-scrollable><template id="imgShop" is="dom-repeat" items="{{imgs}}"><paper-item on-click="addImageShop"><iron-image src="{{item}}"></iron-image></paper-item></template></paper-dialog-scrollable></paper-dialog><google-map fit-to-markers="" api-key="AIzaSyDFsX7B97xHnLZWGD97X6ZGV8H9ZKBiJek" latitude="53.195538" longitude="50.101783"><google-map-marker latitude="{{latitude}}" longitude="{{longitude}}" draggable="true"></google-map-marker></google-map><paper-input bind-value="{{nameShop}}" value="{{nameShop}}" placeholder="Наименование"></paper-input><paper-input id="input" bind-value="{{descriptionShop}}" value="{{descriptionShop}}" placeholder="Описание"></paper-input><paper-input id="input" value="{{searchString}}" placeholder="Строка"></paper-input><button on-click="filter">Filter</button> <button on-click="getAllShops">Get data</button> <button on-click="addShop">Add data</button><google-map fit-to-markers="" api-key="AIzaSyDFsX7B97xHnLZWGD97X6ZGV8H9ZKBiJek" latitude="53.195538" longitude="50.101783"><template is="dom-repeat" items="{{markers}}"><google-map-marker latitude="{{item.latitude}}" longitude="{{item.longitude}}"></google-map-marker></template></google-map><template is="dom-repeat" items="{{shops}}" id="shopList"><div>Name: <span>{{item.name}}</span></div><div>Description: <span>{{item.description}}</span></div><button on-click="delete">x</button> <button on-click="update">update</button></template></template><script>Polymer({is:"shop-list",properties:{nameShop:{type:String},descriptionShop:{type:String},shops:{type:Array,value:[]},markers:{type:Array,value:[]},searchString:{type:String},longitude:{type:Number,value:50.101783},latitude:{type:Number,value:53.195538},imgs:{type:Array,value:[]}},indexedDB:window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB,IDBTransaction:window.IDBTransaction||window.webkitIDBTransaction,db:null,ready:function(){this.initDb(),this.getAllShops()},initDb:function(){var a=this.indexedDB.open("BestPriceDatabase",1);a.onsuccess=function(){this.db=a.result},a.onerror=function(a){console.log("IndexedDB error: "+a.target.errorCode)},a.onupgradeneeded=function(a){var b=a.currentTarget.result.createObjectStore("shop",{keyPath:"id",autoIncrement:!0});b.createIndex("name","name"),b.createIndex("coordinates",["longitude","latitude"]);var b=a.currentTarget.result.createObjectStore("productList",{keyPath:"id",autoIncrement:!0});b.createIndex("date_shop",["date","idShop"])}},addShop:function(){var a,b=this.descriptionShop,c=this.nameShop,d=this.longitude,e=this.latitude,f=this,g=this.indexedDB.open("BestPriceDatabase",1);g.onsuccess=function(){a=g.result;var h=a.transaction("shop","readwrite"),i=h.objectStore("shop");i.add({name:c,description:b,longitude:d,latitude:e}),f.getAllShops()}},getData:function(){var a,b=this.nameShop,c=this.indexedDB.open("BestPriceDatabase",1);c.onsuccess=function(){a=c.result;var d=a.transaction("shop","readwrite"),e=d.objectStore("shop"),f=e.index("name"),g=f.get(b);g.onsuccess=function(){this.descriptionShop="111",console.log(this.descriptionShop)}}},getAllShops:function(){this.shops=[];var a,b=this.indexedDB.open("BestPriceDatabase",1),c=this;b.onsuccess=function(){a=b.result;var d=a.transaction("shop","readwrite"),e=d.objectStore("shop"),f=e.openCursor();f.onsuccess=function(a){a.target.result&&(c.push("shops",{id:a.target.result.value.id,name:a.target.result.value.name,description:a.target.result.value.description}),c.push("markers",{latitude:a.target.result.value.latitude,longitude:a.target.result.value.longitude}),a.target.result["continue"]())},console.log(c.markers)}},delete:function(a){var b,c=this.$.shopList.itemForElement(a.target),d=this.descriptionShop,e=this.nameShop,f=this,g=this.indexedDB.open("BestPriceDatabase",1);g.onsuccess=function(){b=g.result;var a=b.transaction("shop","readwrite"),d=a.objectStore("shop");d.delete(c.id),f.getAllShops()}},update:function(a){var b,c=this.$.shopList.itemForElement(a.target),d=this.descriptionShop,e=this.nameShop,f=this,g=this.indexedDB.open("BestPriceDatabase",1);g.onsuccess=function(){b=g.result;var a=b.transaction("shop","readwrite"),d=a.objectStore("shop");c.name=f.nameShop,c.description=f.descriptionShop,d.put(c),f.getAllShops()}},filter:function(){this.shops=[];var a,b=this.indexedDB.open("BestPriceDatabase",1),c=this;b.onsuccess=function(){a=b.result;var d=a.transaction("shop","readonly"),e=d.objectStore("shop"),f=e.index("name");if(null==c.searchString){var g=e.openCursor();g.onsuccess=function(a){a.target.result&&(c.push("shops",{id:a.target.result.value.id,name:a.target.result.value.name,description:a.target.result.value.description}),a.target.result["continue"]())}}else{var g=f.openCursor(IDBKeyRange.bound(c.searchString,c.searchString+"\uFFFF",!0,!0));g.onsuccess=function(a){a.target.result&&(c.push("shops",{id:a.target.result.value.id,name:a.target.result.value.name,description:a.target.result.value.description}),a.target.result["continue"]())}}}},openDialogImage:function(){this.imgs=[];for(var a=0;a<localStorage.length;a++)key=localStorage.key(a),this.push("imgs",localStorage.getItem(key));this.$.imageForShop.open()},addImageShop:function(a){this.$.idImageShop.src=this.$.imgShop.itemForElement(a.target),this.$.imageForShop.close()}});</script></dom-module></body></html>